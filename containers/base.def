BootStrap: docker
From: nvidia/cuda:12.2.0-devel-ubuntu20.04


%post
   export DEBIAN_FRONTEND=noninteractive

   #! /bin/bash
   # download miniconda
   apt-get -y update
   apt-get upgrade -y
   apt-get install  -y openmpi-bin openmpi-common libopenmpi-dev wget build-essential libhdf5-dev -y
   
   useradd -m -s /bin/bash dsbpredict
   passwd -d dsbpredict
   su - dsbpredict

   # install miniconda
   wget https://repo.anaconda.com/miniconda/Miniconda3-py38_23.5.2-0-Linux-x86_64.sh -O miniconda.sh
   chmod +x miniconda.sh
   sh miniconda.sh -b -p /home/dsbpredict/miniconda3/
   rm -f miniconda.sh

   # add to path
   chmod +x /home/dsbpredict/miniconda3/bin
   /home/dsbpredict/miniconda3/bin/conda --version

   # setup path
   /home/dsbpredict/miniconda3/bin/conda create -n X-CRISP python=3.8

   /home/dsbpredict/miniconda3/envs/X-CRISP/bin/python3 -m pip install mpi4py
   
   chmod -R 755 /home

   unset DEBIAN_FRONTEND

%environment
   export LD_LIBRARY_PATH=/usr/lib/openmpi/lib/